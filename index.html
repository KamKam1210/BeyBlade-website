<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>爆旋陀螺X世代計分系統</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #ff6b35 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        .logo {
            font-size: 2.5em;
            font-weight: bold;
            background: linear-gradient(45deg, #ff6b35, #ffd700, #ff6b35);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2em;
            color: #e0e0e0;
        }

        .language-switch {
            position: absolute;
            top: 0;
            right: 0;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .language-switch:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }

        .page {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        .player-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .player-card {
            background: rgba(255,255,255,0.15);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .player-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(255,107,53,0.3);
        }

        .player-card.selected {
            border-color: #ff6b35;
            background: rgba(255,107,53,0.2);
            transform: scale(1.05);
        }

        .player-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff6b35, #ffd700);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 2em;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .btn {
            background: linear-gradient(45deg, #ff6b35, #ff8c42);
            border: none;
            color: white;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255,107,53,0.3);
            margin: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255,107,53,0.4);
        }

        .btn:active {
            transform: scale(0.95);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #2a5298, #1e3c72);
        }

        .btn-secondary:hover {
            box-shadow: 0 6px 20px rgba(42,82,152,0.4);
        }

        .game-board {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .player-zone {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .player-zone.winner {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #333;
            animation: winnerGlow 1s ease infinite alternate;
        }

        @keyframes winnerGlow {
            from { box-shadow: 0 0 20px rgba(255,215,0,0.5); }
            to { box-shadow: 0 0 30px rgba(255,215,0,0.8); }
        }

        .player-score {
            font-size: 3em;
            font-weight: bold;
            margin: 15px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .score-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
        }

        .score-btn {
            padding: 12px 8px;
            border-radius: 10px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .score-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.3s ease;
        }

        .score-btn:active::before {
            width: 100px;
            height: 100px;
        }

        .xf-btn {
            background: linear-gradient(45deg, #ff6b35, #ff8c42);
            color: white;
        }

        .of-btn {
            background: linear-gradient(45deg, #2a5298, #4169e1);
            color: white;
        }

        .bf-btn {
            background: linear-gradient(45deg, #dc3545, #ff6b6b);
            color: white;
        }

        .sf-btn {
            background: linear-gradient(45deg, #28a745, #4caf50);
            color: white;
        }

        .game-log {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
            margin: 20px 0;
        }

        .log-entry {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            font-size: 0.9em;
        }

        .timer {
            font-size: 2em;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .rules-section {
            margin: 20px 0;
        }

        .rules-section h3 {
            color: #ff6b35;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .rules-section ul {
            list-style: none;
            padding-left: 0;
        }

        .rules-section li {
            background: rgba(255,255,255,0.1);
            margin: 8px 0;
            padding: 12px 15px;
            border-radius: 8px;
            border-left: 4px solid #ff6b35;
        }

        .floating-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #ffd700;
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        .score-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255,107,53,0.9);
            color: white;
            padding: 20px 40px;
            border-radius: 15px;
            font-size: 2em;
            font-weight: bold;
            z-index: 1000;
            opacity: 0;
            scale: 0.5;
            transition: all 0.3s ease;
        }

        .score-popup.show {
            opacity: 1;
            scale: 1;
        }

        @media (max-width: 768px) {
            .logo { font-size: 2em; }
            .game-board { grid-template-columns: 1fr; }
            .score-buttons { grid-template-columns: 1fr; }
            .player-selection { grid-template-columns: repeat(2, 1fr); }
        }

        @media (max-width: 480px) {
            .container { padding: 10px; }
            .card { padding: 20px; }
            .logo { font-size: 1.8em; }
        }
    </style>
</head>
<body>
    <div class="floating-particles" id="particles"></div>
    
    <div class="container">
        <div class="header">
            <button class="language-switch" onclick="toggleLanguage()" id="langBtn">English</button>
            <h1 class="logo" data-zh="爆旋陀螺X世代" data-en="Beyblade X Championship">爆旋陀螺X世代</h1>
            <p class="subtitle" data-zh="專業計分系統" data-en="Professional Scoring System">專業計分系統</p>
        </div>

        <!-- 主選單頁面 -->
        <div class="page active" id="menuPage">
            <div class="card">
                <h2 data-zh="歡迎來到競技場！" data-en="Welcome to the Arena!">歡迎來到競技場！</h2>
                <div style="display: flex; flex-wrap: wrap; justify-content: center; margin: 30px 0;">
                    <button class="btn" onclick="showPage('playerSelectionPage')" data-zh="開始比賽" data-en="Start Battle">開始比賽</button>
                    <button class="btn btn-secondary" onclick="showPage('rulesPage')" data-zh="規則說明" data-en="Rules">規則說明</button>
                    <button class="btn btn-secondary" onclick="showPage('statsPage')" data-zh="比賽統計" data-en="Statistics">比賽統計</button>
                </div>
            </div>
        </div>

        <!-- 選手選擇頁面 -->
        <div class="page" id="playerSelectionPage">
            <div class="card">
                <h2 data-zh="選擇參賽選手 (2-4人)" data-en="Select Players (2-4)">選擇參賽選手 (2-4人)</h2>
                <div class="player-selection">
                    <div class="player-card" onclick="togglePlayer('Peter')">
                        <div class="player-avatar">P</div>
                        <h3>Peter</h3>
                    </div>
                    <div class="player-card" onclick="togglePlayer('Michael')">
                        <div class="player-avatar">M</div>
                        <h3>Michael</h3>
                    </div>
                    <div class="player-card" onclick="togglePlayer('Sam')">
                        <div class="player-avatar">S</div>
                        <h3>Sam</h3>
                    </div>
                    <div class="player-card" onclick="togglePlayer('Mandy')">
                        <div class="player-avatar">M</div>
                        <h3>Mandy</h3>
                    </div>
                    <div class="player-card" onclick="togglePlayer('Amy')">
                        <div class="player-avatar">A</div>
                        <h3>Amy</h3>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-secondary" onclick="showPage('menuPage')" data-zh="返回" data-en="Back">返回</button>
                    <button class="btn" onclick="startGame()" id="startGameBtn" style="opacity: 0.5;" disabled data-zh="開始遊戲" data-en="Start Game">開始遊戲</button>
                </div>
            </div>
        </div>

        <!-- 遊戲頁面 -->
        <div class="page" id="gamePage">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 data-zh="競技場對戰" data-en="Arena Battle">競技場對戰</h2>
                    <div class="timer" id="timer">00:00</div>
                    <div>
                        <button class="btn btn-secondary" onclick="resetRound()" data-zh="重賽" data-en="Reset Round">重賽</button>
                        <button class="btn btn-secondary" onclick="pauseTimer()" id="pauseBtn" data-zh="暫停" data-en="Pause">暫停</button>
                    </div>
                </div>
                
                <div class="game-board" id="gameBoard">
                    <!-- 動態生成選手區域 -->
                </div>

                <div class="game-log">
                    <h4 data-zh="比賽記錄" data-en="Battle Log">比賽記錄</h4>
                    <div id="gameLog"></div>
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-secondary" onclick="endGame()" data-zh="結束比賽" data-en="End Game">結束比賽</button>
                </div>
            </div>
        </div>

        <!-- 結果頁面 -->
        <div class="page" id="resultPage">
            <div class="card">
                <h2 data-zh="比賽結果" data-en="Battle Results">比賽結果</h2>
                <div id="winnerDisplay" style="text-align: center; margin: 30px 0;">
                    <h1 style="font-size: 3em; color: #ffd700; text-shadow: 2px 2px 4px rgba(0,0,0,0.5);">🏆</h1>
                    <h2 id="winnerName" style="color: #ffd700;">Winner</h2>
                </div>
                
                <div class="stats-grid" id="finalStats">
                    <!-- 動態生成最終統計 -->
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn" onclick="showPage('playerSelectionPage')" data-zh="再來一局" data-en="Play Again">再來一局</button>
                    <button class="btn btn-secondary" onclick="showPage('menuPage')" data-zh="回到主選單" data-en="Main Menu">回到主選單</button>
                </div>
            </div>
        </div>

        <!-- 規則頁面 -->
        <div class="page" id="rulesPage">
            <div class="card">
                <h2 data-zh="文藝復興爆旋陀螺 2025官方規則" data-en="Renaissance Beyblade 2025 Official Rules">文藝復興爆旋陀螺 2025官方規則</h2>
                
                <div class="rules-section">
                    <h3 data-zh="計分方式" data-en="Scoring System">計分方式</h3>
                    <ul>
                        <li><strong>Xtreme Finish (XF)</strong> - <span data-zh="3分：對手進入Xtreme Zone且未返回" data-en="3 points: Opponent enters Xtreme Zone and doesn't return">3分：對手進入Xtreme Zone且未返回</span></li>
                        <li><strong>Over Finish (OF)</strong> - <span data-zh="2分：對手進入Over Zone且未返回" data-en="2 points: Opponent enters Over Zone and doesn't return">2分：對手進入Over Zone且未返回</span></li>
                        <li><strong>Burst Finish (BF)</strong> - <span data-zh="2分：對手陀螺部件脫落分離" data-en="2 points: Opponent's Beyblade bursts apart">2分：對手陀螺部件脫落分離</span></li>
                        <li><strong>Spin Finish (SF)</strong> - <span data-zh="1分：對手停止旋轉" data-en="1 point: Opponent stops spinning">1分：對手停止旋轉</span></li>
                    </ul>
                </div>

                <div class="rules-section">
                    <h3 data-zh="勝利條件" data-en="Victory Conditions">勝利條件</h3>
                    <ul>
                        <li data-zh="率先達到4分的選手獲勝" data-en="First player to reach 4 points wins">率先達到4分的選手獲勝</li>
                        <li data-zh="最多支援4人同時對戰" data-en="Maximum 4 players can battle simultaneously">最多支援4人同時對戰</li>
                    </ul>
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-secondary" onclick="showPage('menuPage')" data-zh="返回主選單" data-en="Back to Menu">返回主選單</button>
                </div>
            </div>
        </div>

        <!-- 統計頁面 -->
        <div class="page" id="statsPage">
            <div class="card">
                <h2 data-zh="比賽統計" data-en="Battle Statistics">比賽統計</h2>
                
                <div class="stats-grid" id="playerStats">
                    <!-- 動態生成統計數據 -->
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-secondary" onclick="clearStats()" data-zh="清除統計" data-en="Clear Stats">清除統計</button>
                    <button class="btn btn-secondary" onclick="showPage('menuPage')" data-zh="返回主選單" data-en="Back to Menu">返回主選單</button>
                </div>
            </div>
        </div>
    </div>

    <div class="score-popup" id="scorePopup"></div>

    <script>
        // 全域變數
        let currentLanguage = 'zh';
        let selectedPlayers = [];
        let gameData = {
            players: [],
            scores: {},
            gameLog: [],
            startTime: null,
            timer: null,
            isPaused: false,
            elapsedTime: 0
        };
        let playerStats = JSON.parse(localStorage.getItem('beybladeStats')) || {};

        // 初始化粒子效果
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 6 + 's';
                particle.style.animationDuration = (Math.random() * 3 + 3) + 's';
                particlesContainer.appendChild(particle);
            }
        }

        // 音效函數
        function playSound(type) {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            let frequency;
            
            switch(type) {
                case 'score': frequency = 800; break;
                case 'win': frequency = 1000; break;
                case 'click': frequency = 400; break;
                default: frequency = 600;
            }
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = frequency;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.3);
        }

        // 語言切換
        function toggleLanguage() {
            currentLanguage = currentLanguage === 'zh' ? 'en' : 'zh';
            updateLanguage();
        }

        function updateLanguage() {
            const elements = document.querySelectorAll('[data-zh][data-en]');
            elements.forEach(el => {
                el.textContent = el.getAttribute(`data-${currentLanguage}`);
            });
            
            document.getElementById('langBtn').textContent = currentLanguage === 'zh' ? 'English' : '中文';
        }

        // 頁面管理
        function showPage(pageId) {
            playSound('click');
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            
            if (pageId === 'statsPage') {
                loadPlayerStats();
            }
        }

        // 選手選擇
        function togglePlayer(playerName) {
            playSound('click');
            const playerCard = event.currentTarget;
            
            if (selectedPlayers.includes(playerName)) {
                selectedPlayers = selectedPlayers.filter(p => p !== playerName);
                playerCard.classList.remove('selected');
            } else if (selectedPlayers.length < 4) {
                selectedPlayers.push(playerName);
                playerCard.classList.add('selected');
            }
            
            updateStartButton();
        }

        function updateStartButton() {
            const startBtn = document.getElementById('startGameBtn');
            if (selectedPlayers.length >= 2) {
                startBtn.disabled = false;
                startBtn.style.opacity = '1';
            } else {
                startBtn.disabled = true;
                startBtn.style.opacity = '0.5';
            }
        }

        // 遊戲開始
        function startGame() {
            if (selectedPlayers.length < 2) return;
            
            playSound('click');
            gameData = {
                players: [...selectedPlayers],
                scores: {},
                gameLog: [],
                startTime: Date.now(),
                timer: null,
                isPaused: false,
                elapsedTime: 0
            };
            
            // 初始化分數
            selectedPlayers.forEach(player => {
                gameData.scores[player] = 0;
                if (!playerStats[player]) {
                    playerStats[player] = { wins: 0, totalGames: 0, totalScore: 0 };
                }
            });
            
            createGameBoard();
            startTimer();
            showPage('gamePage');
        }

        // 創建遊戲版面
        function createGameBoard() {
            const gameBoard = document.getElementById('gameBoard');
            gameBoard.innerHTML = '';
            
            gameData.players.forEach(player => {
                const playerZone = document.createElement('div');
                playerZone.className = 'player-zone';
                playerZone.innerHTML = `
                    <div class="player-avatar">${player[0]}</div>
                    <h3>${player}</h3>
                    <div class="player-score">${gameData.scores[player]}</div>
                    <div class="score-buttons">
                        <button class="score-btn xf-btn" onclick="addScore('${player}', 3, 'XF')">
                            XF<br>+3
                        </button>
                        <button class="score-btn of-btn" onclick="addScore('${player}', 2, 'OF')">
                            OF<br>+2
                        </button>
                        <button class="score-btn bf-btn" onclick="addScore('${player}', 2, 'BF')">
                            BF<br>+2
                        </button>
                        <button class="score-btn sf-btn" onclick="addScore('${player}', 1, 'SF')">
                            SF<br>+1
                        </button>
                    </div>
                `;
                gameBoard.appendChild(playerZone);
            });
        }

        // 計分功能
        function addScore(player, points, type) {
            playSound('score');
            gameData.scores[player] += points;
            
            // 更新分數顯示
            updateScoreDisplay();
            
            // 記錄到遊戲日誌
            const logEntry = `${player} ${type} +${points}分`;
            gameData.gameLog.unshift(logEntry);
            updateGameLog();
            
            // 顯示得分動畫
            showScorePopup(`${player} ${type} +${points}`);
            
            // 檢查是否有人獲勝
            if (gameData.scores[player] >= 4) {
                setTimeout(() => endGameWithWinner(player), 1000);
            }
        }

        function updateScoreDisplay() {
            gameData.players.forEach(player => {
                const scoreElement = document.querySelector(`[data-player="${player}"] .player-score`) || 
                                   document.querySelector(`.player-zone:nth-child(${gameData.players.indexOf(player) + 1}) .player-score`);
                if (scoreElement) {
                    scoreElement.textContent = gameData.scores[player];
                }
            });
        }

        function updateGameLog() {
            const gameLog = document.getElementById('gameLog');
            gameLog.innerHTML = gameData.gameLog.slice(0, 10).map(entry => 
                `<div class="log-entry">${entry}</div>`
            ).join('');
        }

        function showScorePopup(text) {
            const popup = document.getElementById('scorePopup');
            popup.textContent = text;
            popup.classList.add('show');
            
            setTimeout(() => {
                popup.classList.remove('show');
            }, 1500);
        }

        // 計時器功能
        function startTimer() {
            gameData.timer = setInterval(updateTimer, 1000);
        }

        function updateTimer() {
            if (!gameData.isPaused) {
                gameData.elapsedTime = Date.now() - gameData.startTime;
            }
            
            const minutes = Math.floor(gameData.elapsedTime / 60000);
            const seconds = Math.floor((gameData.elapsedTime % 60000) / 1000);
            
            document.getElementById('timer').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function pauseTimer() {
            const pauseBtn = document.getElementById('pauseBtn');
            
            if (gameData.isPaused) {
                gameData.startTime = Date.now() - gameData.elapsedTime;
                startTimer();
                pauseBtn.textContent = currentLanguage === 'zh' ? '暫停' : 'Pause';
                gameData.isPaused = false;
            } else {
                clearInterval(gameData.timer);
                pauseBtn.textContent = currentLanguage === 'zh' ? '繼續' : 'Resume';
                gameData.isPaused = true;
            }
        }

        // 重賽功能
        function resetRound() {
            playSound('click');
            if (confirm(currentLanguage === 'zh' ? '確定要重賽這一輪嗎？' : 'Reset this round?')) {
                // 清除最近的得分記錄
                if (gameData.gameLog.length > 0) {
                    gameData.gameLog = [];
                    updateGameLog();
                }
            }
        }

        // 結束遊戲
        function endGame() {
            if (confirm(currentLanguage === 'zh' ? '確定要結束比賽嗎？' : 'End the game?')) {
                clearInterval(gameData.timer);
                showPage('menuPage');
                resetGame();
            }
        }

        function endGameWithWinner(winner) {
            playSound('win');
            clearInterval(gameData.timer);
            
            // 更新統計數據
            gameData.players.forEach(player => {
                playerStats[player].totalGames++;
                playerStats[player].totalScore += gameData.scores[player];
                if (player === winner) {
                    playerStats[player].wins++;
                }
            });
            
            // 保存統計數據
            localStorage.setItem('beybladeStats', JSON.stringify(playerStats));
            
            // 顯示結果頁面
            showGameResult(winner);
            showPage('resultPage');
        }

        function showGameResult(winner) {
            document.getElementById('winnerName').textContent = winner;
            
            const finalStats = document.getElementById('finalStats');
            finalStats.innerHTML = gameData.players.map(player => `
                <div class="stat-card ${player === winner ? 'winner' : ''}">
                    <h4>${player}</h4>
                    <div style="font-size: 2em; font-weight: bold; margin: 10px 0;">
                        ${gameData.scores[player]}
                    </div>
                    <div style="font-size: 0.9em; opacity: 0.8;">
                        ${player === winner ? (currentLanguage === 'zh' ? '勝利者！' : 'Winner!') : ''}
                    </div>
                </div>
            `).join('');
        }

        function resetGame() {
            selectedPlayers = [];
            document.querySelectorAll('.player-card').forEach(card => {
                card.classList.remove('selected');
            });
            updateStartButton();
        }

        // 統計功能
        function loadPlayerStats() {
            const statsContainer = document.getElementById('playerStats');
            const players = ['Peter', 'Michael', 'Sam', 'Mandy', 'Amy'];
            
            statsContainer.innerHTML = players.map(player => {
                const stats = playerStats[player] || { wins: 0, totalGames: 0, totalScore: 0 };
                const winRate = stats.totalGames > 0 ? ((stats.wins / stats.totalGames) * 100).toFixed(1) : 0;
                const avgScore = stats.totalGames > 0 ? (stats.totalScore / stats.totalGames).toFixed(1) : 0;
                
                return `
                    <div class="stat-card">
                        <div class="player-avatar">${player[0]}</div>
                        <h4>${player}</h4>
                        <div><strong>${stats.wins}</strong> ${currentLanguage === 'zh' ? '勝' : 'Wins'}</div>
                        <div><strong>${stats.totalGames}</strong> ${currentLanguage === 'zh' ? '場' : 'Games'}</div>
                        <div><strong>${winRate}%</strong> ${currentLanguage === 'zh' ? '勝率' : 'Win Rate'}</div>
                        <div><strong>${avgScore}</strong> ${currentLanguage === 'zh' ? '平均分' : 'Avg Score'}</div>
                    </div>
                `;
            }).join('');
        }

        function clearStats() {
            if (confirm(currentLanguage === 'zh' ? '確定要清除所有統計數據嗎？' : 'Clear all statistics?')) {
                playerStats = {};
                localStorage.removeItem('beybladeStats');
                loadPlayerStats();
            }
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            createParticles();
            updateLanguage();
            
            // 確保所有統計數據完整
            ['Peter', 'Michael', 'Sam', 'Mandy', 'Amy'].forEach(player => {
                if (!playerStats[player]) {
                    playerStats[player] = { wins: 0, totalGames: 0, totalScore: 0 };
                }
            });
        });

        // 鍵盤快捷鍵
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('gamePage').classList.contains('active')) {
                // 遊戲頁面的快捷鍵
                if (e.key === ' ') {
                    e.preventDefault();
                    pauseTimer();
                }
            }
        });
    </script>
</body>
</html>
